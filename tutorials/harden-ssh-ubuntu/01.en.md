---
SPDX-License-Identifier: MIT
path: "/tutorials/tutorial-template"
slug: "tutorial-template"
date: "2030-01-01"
title: "How To Harden SSH On Ubuntu"
short_description: "Securing and hardening SSH is a very important part of setting up a server."
tags: ["Security"]
author: "Noah Krasser"
author_link: "https://github.com/NoahDoah"
author_img: "https://avatars3.githubusercontent.com/u/14371498?s=400&u=27092cffd550c868617163649ff1ebe0f56f355e&v=4"
author_description: ""
header_img: ""
---

<!-- This where the actual tutorial begins, with the title: -->

# How To Harden SSH On Ubuntu

## Introduction

Securing and hardening SSH is a very important part of setting up a server and should be done as soon as possible. This tutorial is about using a username-and-password login. 

**A warning:** Be careful when working with SSH-configs or even firewall-settings. You can easily lock yourself out. 

**Another warning:** All the shown configurations and software are based on one single thing: A good password. Using ```cats123``` as password might be more or less tolerable for your private PC but it is **NOT** for a public server! An example for a good password would be this one, generated by the password-manager KeePass: *JWErC7PIUMYFa7w6rTVL*.

**Prerequisites**

First, you should already have a sudo-user set up. Follow [this tutorial](https://www.digitalocean.com/community/tutorials/how-to-create-a-sudo-user-on-ubuntu-quickstart) on how to do this if you haven't.

## Step 1 - Configuring OpenSSH

First of all we will change some default config of OpenSSH. You also wanna be logged in with your sudo-user, not root.

### Step 1.1 - Backup

Backups are always good, so we quickly create one of the file:

```
cp /etc/ssh/sshd_config /etc/ssh/sshd_config_backup
```

### Step 1.2 - Disable Root Login

Open the config-file with your preferred editor.

```
nano /etc/ssh/sshd_config
```

Find the line saying ```PermitRootLogin``` and set it to no:

```
PermitRootLogin no
```

### Step 1.3 - Set Idle Session Disconnect

You can now also set an idle session disconnect. Data protection authorities will like this. So if this server is processing and/or storing personal data you will want to set this.

```
ClientAliveInterval 300
ClientAliveCountMax 1
```

```ClientActiveInterval``` defines the interval between the server sending alive messages to the client after no data has been received. In that case 300 seconds are 5 minutes. ```ClientAliveCountMax``` defines the amount of checks to be made before a disconnect. 

### Step 1.4 - Whitelist Users

A whitelist is a list of users that sets the users allowed to log in via SSH. Everyone not on the list can't connect. Multiple users are seperated by spaces. Don't forget to add your sudo-user to the list.

```
AllowUsers holu holu2
```

### Step 1.5 - Change The Default SSH Port

The default SSH-port that we all know and love is 22. You can change this port to avoid non-targeted attacks on your server.

Find the line ```Port 22``` and change it to something else, preferably a port < 1024 to also avoid DoS-attacks from local users.

```
Port 994
```

### Step 1.6 - Reload SSH

After making the changes of the config you can now leave the file (In nano first save using CTRL+O and then exit using CTRL+X).

First test your config on any errors using

```
sshd -t
```

If there are any errors in your config go back into the file and find them. If there are no errors you can now reload the daemon:

```
systemctl reload sshd
```

## Step 2 - Install Fail2Ban

Fail2Ban is a great program that will ban IPs failing to log themselves in, meaning it will ban brute-forcers.

Install it using

```
apt-get install fail2ban
```

There is a default config file named ```jail.conf``` but we will not use it, as it can be overwritten when updating the package. That's why we copy this file and rename it to ```jail.local```, which will not be overwritten when updating.

```
cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
```

Open it with your preferred editor:

```
nano /etc/fail2ban/jail.local
```

Now search the SSHD-section starting with ```[sshd]``` and add ```enabled = true``` below it. If you have changed the SSH-port in the previous step change it here as well. After the changes the section will look similar to this:

```
[sshd]

enabled = true
port = 994
logpath = %(sshd_log)s
```

You can also change the values of ```bantime```, ```findtime``` and ```maxretry``` however you want. A short description on what they do is in the file.

Save the file, exit and restart fail2ban:

```
service fail2ban restart
```

## Conclusion

So, these were basic hardening strategies for SSH and username-password-login. It should already safe you from rootkits like XoR-DDoS for example (I can tell from own experience...).

##### License: MIT

<!---

Contributors's Certificate of Origin

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I have
    the right to submit it under the license indicated in the file; or

(b) The contribution is based upon previous work that, to the best of my
    knowledge, is covered under an appropriate license and I have the
    right under that license to submit that work with modifications,
    whether created in whole or in part by me, under the same license
    (unless I am permitted to submit under a different license), as
    indicated in the file; or

(c) The contribution was provided directly to me by some other person
    who certified (a), (b) or (c) and I have not modified it.

(d) I understand and agree that this project and the contribution are
    public and that a record of the contribution (including all personal
    information I submit with it, including my sign-off) is maintained
    indefinitely and may be redistributed consistent with this project
    or the license(s) involved.

Signed-off-by: Noah Krasser noah@krasser.xyz

-->
